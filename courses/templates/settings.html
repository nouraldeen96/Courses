<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;200;300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="{{url_for('static', filename='css/style.css')}}">
	<meta charset="UTF-8">
	<title>Account Settings</title>
	<meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
	<link rel="stylesheet" type="text/css" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
	<link rel="stylesheet" type="text/css" href="{{url_for('static', filename='css/settingstyle.css')}}">
</head>
<body>
	<header style="background:linear-gradient(white,white); min-height: 100px; overflow: visible;">
        
        <nav id="nav" style="display: flex;justify-content:space-between; flex-direction: row;">
            <a href="/" style="text-decoration: none;"><h1 class="logo">COURSES</h1></a>
            <div style="display: flex;justify-content:space-between; flex-direction: row;">
                
                <div id="logged" class="dropdown" style=" position: absolute; right: 100px; top:10px;justify-content:space-between; position: relative">
                    <button id="text_name" class="btn btn-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" style="color:white; font-size: 20px;border:none; background-color: transparent;">
                      
                    </button>
                    <img id="img_profile" src="images/default_user.png" class="userAvatar"  style="height: 60px; width:60px;position: absolute;top:-20px;  right:-95px; margin:0 25px; border-radius: 50%;">
                    <ul class="dropdown-menu dropdown-menu-dark">
                      <li><a class="dropdown-item" href="/">Home</a></li>
                      <li><a class="dropdown-item" href="/settings">Settings</a></li>
                      <li><a class="dropdown-item" href="/my_courses">My Courses</a></li>
                      <li><hr class="dropdown-divider"></li>
                      <li><a class="dropdown-item" href="#" onclick="logout()">Sign Out</a></li>
                    </ul>
                </div>
            </div>
           

        </nav>
       
        
    </header>
	<section class="py-5 my-5">
		<div class="container">
			<div class="bg-white shadow rounded-lg d-block d-sm-flex">
				<div class="profile-tab-nav border-right">
					<div class="p-4">
						<div id="show_img" class="img-circle text-center mb-3">
							<img id="img_form" src="images/default_user.png" alt="Image" class="shadow" style="width:250px; height: 250px;">
						</div>
						<h4 class="text-center" id="text_form"></h4>
						<div id="addimg">
							<label for="update_img" title="Add Photo">+</label><br>
							<input type="file" id="update_img" accept="image/*" onchange="showImg(event)">
						</div>
					</div>
					
					<div class="nav flex-column nav-pills" id="v-pills-tab" role="tablist" aria-orientation="vertical">
						<a class="nav-link active" id="account-tab" data-toggle="pill" href="#account" role="tab" aria-controls="account" aria-selected="true">
							<i class="fa fa-home text-center mr-1"></i> 
							Account
						</a>
						<a class="nav-link" id="password-tab" data-toggle="pill" href="#password" role="tab" aria-controls="password" aria-selected="false">
							<i class="fa fa-key text-center mr-1"></i> 
							Password
						</a>
					
					</div>
				</div>
				<div class="tab-content p-4 p-md-5" id="v-pills-tabContent">
					<div class="tab-pane fade show active" id="account" role="tabpanel" aria-labelledby="account-tab">
						<h3 class="mb-4">Account Settings</h3>
						<div class="row">
							<div class="col-md-6">
								<div class="form-group">
								  	<label>Name</label>
								  	<input id="name" type="text" class="form-control" >
								</div>
							</div>
							
							<div class="col-md-6">
								<div class="form-group">
								  	<label>Email</label>
								  	<input id="email" type="text" class="form-control">
								</div>
							</div>
							<div class="col-md-6">
								<div class="form-group">
								  	<label>Phone number</label>
								  	<input id="phone" type="text" class="form-control">
								</div>
							</div>
							
						</div>
						<div>
							<button class="btn btn-primary" onclick='updateUser()'>Update</button>
						</div>
					</div>
					<div class="tab-pane fade" id="password" role="tabpanel" aria-labelledby="password-tab">
						<h3 class="mb-4">Password Settings</h3>
						<div class="row">
							<div class="col-md-6">
								<div class="form-group">
								  	<label>Old password</label>
								  	<input id="oldPassword" type="password" class="form-control">
								</div>
							</div>
						</div>
						<div class="row">
							<div class="col-md-6">
								<div class="form-group">
								  	<label>New password</label>
								  	<input  id="password1" type="password" class="form-control">
								</div>
							</div>
							<div class="col-md-6">
								<div class="form-group">
								  	<label>Confirm new password</label>
								  	<input id="password2" type="password" class="form-control">
								</div>
							</div>
						</div>
						<div>
							<button class="btn btn-primary" onclick="updatepassword()">Update</button>
						</div>
					</div>
			</div>
	</section>


	<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
</body>
<style>
	

</style>

<script>
	function showDetails(){
		let name_profile = document.querySelector("#text_name")
		let img_profile = document.querySelector("#img_profile")
		let text_form = document.querySelector("#text_form")
		let img_form = document.querySelector("#img_form")
		let name = document.getElementById("name")
        let email = document.getElementById("email")
        let phone = document.getElementById("phone")

		name_profile.innerHTML = localStorage.getItem('text_user')
		img_profile.src = localStorage.getItem('photo')
		text_form.innerHTML = localStorage.getItem('text_user')
		img_form.src = localStorage.getItem('photo')
		name.value = localStorage.getItem('text_user')
		email.value = localStorage.getItem('email')
		phone.value = localStorage.getItem('phone')

    }
    showDetails()


	function showImg(event){
		if(event.target.files.length > 0){
		  var src = URL.createObjectURL(event.target.files[0]);
		  var preview = document.getElementById("img_form");
		  preview.src = src;
		  preview.style.display = "block";
		}
	  }


	  function updateUser(){ 
		const token = window.localStorage.getItem('token')
		const name = document.getElementById("name").value
		const email = document.getElementById("email").value
		const phone = document.getElementById("phone").value
        const img = document.getElementById("update_img").files[0]

		
		let formData = new FormData()
		formData.append("name",name)
		formData.append("email",email)
		formData.append("phone",phone)
		formData.append("img", img)
		
	 
		
		axios.put(`/updateuser`,formData,{
		headers:{
			"Content-Type":"multipart/form-data",
			'authorization':`Bearer ${token}`
		}
		})
		.then(function (response) {
		Swal.fire("Updated", 'Please log out to see updates', 'success')
		})
		.catch(function (response) {
			Swal.fire({
				icon: 'error',
				title: 'Oops...',
				text: response.request.response,
			  })
		  })
		}  

		const isValidPassword = password => {
			const re = /[^\w]/g;
			return re.test(String(password))
			}

		function updatepassword(){ 
			const token = window.localStorage.getItem('token')
			const oldPassword = document.getElementById("oldPassword").value
			const password1 = document.getElementById("password1").value
			const password2 = document.getElementById("password2").value
			if (oldPassword === '' | password1 === '' | password2 === ''  ){
				Swal.fire("Please fill all feilds", '', 'info')
			}
			else if (password1.length < 8 | isValidPassword(password1)){
				Swal.fire("New password must be 8 characters or more", '', 'info')
			}
			else if (password1 != password2){
				Swal.fire("Check confirm new password", '', 'info')
			}
			else{
				let formData = new FormData()
				formData.append("oldPassword",oldPassword)
				formData.append("newPassword",password1)

				axios.put(`/updateuserpassword`,formData,{
					headers:{
						"Content-Type":"multipart/form-data",
						'authorization':`Bearer ${token}`
					}
					})
				.then(function (response) {
				Swal.fire("Updated password", 'success')
				})
				.catch(function (response) {
					Swal.fire({
						icon: 'error',
						title: 'Oops...',
						text: response.request.response,
					  })
				  })
				}
				  

			}
	
	function logout(){
        localStorage.clear()
        Swal.fire("logged out successfully", '', 'success')
        setTimeout(function(){
            window.location.assign(`/`)
          } ,2000)
      }
	

</script>
<style>
	#update_img{
		display: none;
	}
	
	
	#addimg label{
		display:block;
		position: relative;
		top:10px;
		left: 100px;
		width:50px;
		height:50px;
		line-height:50px;
		text-align:center;
		background:#007bff;
		color:#fff;
		font-size:25px;
		font-family:"Open Sans",sans-serif;
		text-transform:Uppercase;
		font-weight:800;
		border-radius:50%;
		cursor:pointer;
	}
	
</style>
</html>

